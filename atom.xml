<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cpl.Kerry</title>
  
  
  <link href="https://rickg.cn/atom.xml" rel="self"/>
  
  <link href="https://rickg.cn/"/>
  <updated>2022-08-10T09:51:36.637Z</updated>
  <id>https://rickg.cn/</id>
  
  <author>
    <name>Rick</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>设置OpenWrt的防火墙，从外网访问内网服务</title>
    <link href="https://rickg.cn/2022/08/10/openwrt-config-ipv6-firewall/"/>
    <id>https://rickg.cn/2022/08/10/openwrt-config-ipv6-firewall/</id>
    <published>2022-08-10T09:50:51.000Z</published>
    <updated>2022-08-10T09:51:36.637Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在运营商提供IPv6后，家中每一个内网设备都会拥有IPv6地址。</p><p>但是发现内网的设备，虽然有公网IPv6地址，但是仅仅能ping通，无法从外网访问。</p><p>最后发现是OpenWrt的防火墙阻断了连接，于是决定通过设置OpenWrt防火墙来开放端口。</p><h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><p>打开OpenWrt管理界面，点击<code>网络</code> → <code>防火墙</code> → <code>通信规则</code></p><p>点击<code>添加与编辑</code>：</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220810174525648.png" alt="image-20220810174525648"></p><p>按图编辑：</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220810174827165.png" alt="image-20220810174827165"></p><p>保存后，外网设备可以正常访问了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;在运营商提供IPv6后，家中每一个内网设备都会拥有IPv6地址。&lt;/p&gt;
&lt;p&gt;但是发现内网的设备，虽然有公网IPv6地址，但是仅仅能pin</summary>
      
    
    
    
    
    <category term="openwrt" scheme="https://rickg.cn/tags/openwrt/"/>
    
  </entry>
  
  <entry>
    <title>为比特彗星开放IPv6端口</title>
    <link href="https://rickg.cn/2022/08/07/bitcomet-ipv6-green-light/"/>
    <id>https://rickg.cn/2022/08/07/bitcomet-ipv6-green-light/</id>
    <published>2022-08-07T10:09:45.000Z</published>
    <updated>2022-08-07T10:11:33.730Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip6tables -A FORWARD -p tcp --dport [BitComet端口] -j ACCEPT</span><br><span class="line">ip6tables -A FORWARD -p udp --dport [BitComet端口] -j ACCEPT</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;</summary>
      
    
    
    
    
    <category term="bitcomet" scheme="https://rickg.cn/tags/bitcomet/"/>
    
  </entry>
  
  <entry>
    <title>E5SubBot的配置使用</title>
    <link href="https://rickg.cn/2022/07/10/configure-e5sub-bot/"/>
    <id>https://rickg.cn/2022/07/10/configure-e5sub-bot/</id>
    <published>2022-07-10T08:11:38.000Z</published>
    <updated>2022-07-14T09:23:43.502Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在拥有Office E5订阅后，如何续期成了一个大问题。最近找到了一个GitHub项目：<a href="https://github.com/iyear/E5SubBot">iyear&#x2F;E5SubBot</a>，决定用它来续期E5。</p><h2 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h2><ul><li>1 * VPS（要能访问Telegram）</li><li>1 * Office E5账号</li><li>1 * Telegram账号</li></ul><h2 id="申请Telegram机器人"><a href="#申请Telegram机器人" class="headerlink" title="申请Telegram机器人"></a>申请Telegram机器人</h2><p>添加@BotFather机器人，输入<code>/start </code>开始</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220710162212450.png" alt="image-20220710162212450"></p><p>输入<code>/newbot</code>创建新机器人</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220710162320105.png" alt="image-20220710162320105"></p><p>输入bot名字</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220710162345391.png" alt="image-20220710162345391"></p><p>输入bot用户名，得到bot的Token</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220710162516659.png" alt="image-20220710162516659"></p><h2 id="配置E5SubBot"><a href="#配置E5SubBot" class="headerlink" title="配置E5SubBot"></a>配置E5SubBot</h2><p>在 <a href="https://github.com/iyear/E5SubBot/releases">Releases</a> 页面下载对应系统的二进制文件，上传至服务器</p><p>重命名<code>config.yml.example</code>为<code>config.yml</code></p><p>编辑<code>config.yml</code>，将<code>bot_token</code>一项的值修改为刚刚获取的Token</p><p>前往 <a href="https://t.me/userinfobot">https://t.me/userinfobot</a> 获取自己的tgid，并填入<code>admin</code>项中</p><h2 id="启动E5SubBot"><a href="#启动E5SubBot" class="headerlink" title="启动E5SubBot"></a>启动E5SubBot</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">screen -S e5sub</span><br><span class="line">chmod +x E5SubBot</span><br><span class="line">./E5SubBot</span><br><span class="line">(Ctrl A+D)</span><br></pre></td></tr></table></figure><h2 id="绑定账号"><a href="#绑定账号" class="headerlink" title="绑定账号"></a>绑定账号</h2><p>参照以下教程（图片来自网络）</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/E5Sub_1.jpg" alt="E5Sub_1"></p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/E5Sub_2.jpg" alt="E5Sub_2"></p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/E5Sub_3.jpg" alt="E5Sub_3"></p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/E5Sub_4.jpg" alt="E5Sub_4"></p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/E5Sub_5.jpg" alt="E5Sub_5"></p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/E5Sub_6.jpg" alt="E5Sub_6"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;在拥有Office E5订阅后，如何续期成了一个大问题。最近找到了一个GitHub项目：&lt;a href=&quot;https://github.co</summary>
      
    
    
    
    
    <category term="Office E5" scheme="https://rickg.cn/tags/Office-E5/"/>
    
  </entry>
  
  <entry>
    <title>记一次给PVE配置ddns</title>
    <link href="https://rickg.cn/2022/06/01/pve-configure-ddns/"/>
    <id>https://rickg.cn/2022/06/01/pve-configure-ddns/</id>
    <published>2022-06-01T01:33:07.000Z</published>
    <updated>2022-06-03T13:51:28.449Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>随着ipv6的普及，越来越多的终端支持ipv6。因此我决定给家中的Proxmox VE配置ipv6并配置ddns以通过外网访问。</p><h3 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h3><ul><li>一台支持ipv6的路由器</li><li>Proxmox VE主机</li><li>一个域名</li><li><a href="https://github.com/jeessy2/ddns-go">ddns-go</a></li></ul><h2 id="为Proxmox-VE启用ipv6"><a href="#为Proxmox-VE启用ipv6" class="headerlink" title="为Proxmox VE启用ipv6"></a>为Proxmox VE启用ipv6</h2><p>Proxmox安装后默认没有通过SLAAC配置公网ipv6地址，需要手动配置</p><p>在<code>/etc/sysctl.conf</code>中添加：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">net.ipv6.conf.all.accept_ra=2</span><br><span class="line">net.ipv6.conf.default.accept_ra=2</span><br><span class="line">net.ipv6.conf.vmbr0.accept_ra=2</span><br><span class="line">net.ipv6.conf.all.autoconf=1</span><br><span class="line">net.ipv6.conf.default.autoconf=1</span><br><span class="line">net.ipv6.conf.vmbr0.autoconf=1</span><br></pre></td></tr></table></figure><p>来为vmbr0网桥启用自动获取公网ipv6地址</p><p>重启后输入<code>ifconfig</code>：</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220601090839399.png" alt="image-20220601090839399"></p><p>ping外网也是正常的</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220601090957203.png" alt="image-20220601090957203"></p><h2 id="安装ddns-go"><a href="#安装ddns-go" class="headerlink" title="安装ddns-go"></a>安装ddns-go</h2><p>前往项目的<a href="https://github.com/jeessy2/ddns-go/releases">GitHub Release页面</a>下载最新版本，这里以3.7.1版为例</p><h3 id="解压到-x2F-opt"><a href="#解压到-x2F-opt" class="headerlink" title="解压到&#x2F;opt"></a>解压到&#x2F;opt</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/ddns-go</span><br><span class="line">tar -zxvf ddns-go_3.7.1_Linux_x86_64.tar.gz -C /opt/ddns-go</span><br></pre></td></tr></table></figure><h3 id="设置为系统服务"><a href="#设置为系统服务" class="headerlink" title="设置为系统服务"></a>设置为系统服务</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/ddns-go</span><br><span class="line">./ddns-go -s install</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">卸载服务请执行 ./ddns-go -s uninstall</span></span><br></pre></td></tr></table></figure><h2 id="配置ddns-go"><a href="#配置ddns-go" class="headerlink" title="配置ddns-go"></a>配置ddns-go</h2><p>访问<code>http://[服务器ip]:9876</code></p><p>设置dns服务商</p><p>勾选<code>IPv6</code>项下的<code>是否启用</code>，并添加解析域名</p><p>现在可以通过指定的域名来访问pve服务了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;随着ipv6的普及，越来越多的终端支持ipv6。因此我决定给家中的Proxmox VE配置ipv6并配置ddns以通过外网访问。&lt;/p&gt;
&lt;</summary>
      
    
    
    
    
    <category term="pve" scheme="https://rickg.cn/tags/pve/"/>
    
    <category term="ddns" scheme="https://rickg.cn/tags/ddns/"/>
    
  </entry>
  
  <entry>
    <title>为Cloudreve添加离线下载节点</title>
    <link href="https://rickg.cn/2022/05/29/cloudreve-child-node/"/>
    <id>https://rickg.cn/2022/05/29/cloudreve-child-node/</id>
    <published>2022-05-29T14:49:07.000Z</published>
    <updated>2022-05-29T14:49:52.353Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在配置<a href="https://rickg.cn/2022/05/29/cloudreve/">Cloudreve</a>期间，发现VPS仅有的60G空间对于离线下载远远不够，因此决定将内网的一台机器作为Cloudreve的离线下载节点。</p><h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>在子节点上运行Cloudreve和Aria2，并通过<a href="https://rickg.cn/2022/05/28/how-to-configure-frp/">frp</a>将子节点服务暴露给公网，最后通过Cloudreve自带的功能进行子节点离线下载</p><blockquote><p><em>Cloudreve 支持“从机离线下载”，您可以将离线下载任务分流至多台服务器处理，避免这些任务过多占用主机的资源。每个负责处理离线下载任务的节点需要运行一组 Cloudreve 和 Aria2 实例。您可以按照管理面板中的节点添加向导指引配置并添加新节点。</em></p></blockquote><h3 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h3><ul><li>1 * 拥有公网ip的机器</li><li>1 * 无公网ip的机器</li><li><a href="https://github.com/fatedier/frp/">frp</a>软件</li><li><a href="https://github.com/cloudreve/Cloudreve/">Cloudreve</a></li></ul><h2 id="准备步骤"><a href="#准备步骤" class="headerlink" title="准备步骤"></a>准备步骤</h2><h3 id="内网机"><a href="#内网机" class="headerlink" title="内网机"></a>内网机</h3><h4 id="安装Cloudreve"><a href="#安装Cloudreve" class="headerlink" title="安装Cloudreve"></a>安装Cloudreve</h4><p>参见<a href="https://rickg.cn/2022/05/29/cloudreve/">安装配置Cloudreve</a></p><h4 id="安装frp"><a href="#安装frp" class="headerlink" title="安装frp"></a>安装frp</h4><p>参见<a href="https://rickg.cn/2022/05/28/how-to-configure-frp/">frp内网穿透教程</a></p><h4 id="安装aria2"><a href="#安装aria2" class="headerlink" title="安装aria2"></a>安装aria2</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install aria2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建aria2配置文件</span></span><br><span class="line">mkdir -p /etc/aria2</span><br><span class="line">nano /etc/aria2/aria2.conf</span><br></pre></td></tr></table></figure><p>在<code>/etc/aria2/aria2.conf</code>中添加</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 启用 RPC 服务</span><br><span class="line">enable-rpc=true</span><br><span class="line"># RPC 监听端口</span><br><span class="line">rpc-listen-port=6800</span><br><span class="line"># RPC 授权令牌，可自行设定</span><br><span class="line">rpc-secret=&lt;your token&gt;</span><br></pre></td></tr></table></figure><p>创建aria2用户</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd aria2</span><br></pre></td></tr></table></figure><p>编辑<code>/etc/systemd/system/aria2c.service</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description= Aria2c Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=aria2</span><br><span class="line">ExecStart=/usr/bin/aria2c --conf-path=/etc/aria2/aria2.conf</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>创建离线下载临时文件夹，并设置权限防止报错</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /offline_download</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将所有者改为aria2用户并设置权限</span></span><br><span class="line">chown -R aria2 /offline_download</span><br><span class="line">chmod -R 777 /offline_download</span><br></pre></td></tr></table></figure><h4 id="配置frp"><a href="#配置frp" class="headerlink" title="配置frp"></a>配置frp</h4><p><code>/etc/frp/frpc.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = 公网机ip</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[https2http]</span></span><br><span class="line"><span class="attr">type</span> = https</span><br><span class="line"><span class="attr">custom_domains</span> = 访问内网服务用的域名</span><br><span class="line"></span><br><span class="line"><span class="attr">plugin</span> = https2http</span><br><span class="line"><span class="attr">plugin_local_addr</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">5212</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPS 证书相关的配置</span></span><br><span class="line"><span class="attr">plugin_crt_path</span> = 域名证书crt文件路径</span><br><span class="line"><span class="attr">plugin_key_path</span> = 域名证书key文件路径</span><br><span class="line"><span class="attr">plugin_host_header_rewrite</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">plugin_header_X-From-Where</span> = frp</span><br></pre></td></tr></table></figure><blockquote><p>注：这里我公网机Cloudreve使用了https，则暴露内网机服务时必须也使用https</p></blockquote><h3 id="公网机"><a href="#公网机" class="headerlink" title="公网机"></a>公网机</h3><h4 id="安装frp、Cloudreve略"><a href="#安装frp、Cloudreve略" class="headerlink" title="安装frp、Cloudreve略"></a>安装frp、Cloudreve略</h4><h4 id="配置frp-1"><a href="#配置frp-1" class="headerlink" title="配置frp"></a>配置frp</h4><p>在服务端frp配置中添加用于访问内网Cloudreve的HTTPS端口</p><p><code>/etc/frp/frps.ini</code>：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">vhost_https_port</span> = 访问用端口</span><br></pre></td></tr></table></figure><h2 id="配置Cloudreve"><a href="#配置Cloudreve" class="headerlink" title="配置Cloudreve"></a>配置Cloudreve</h2><p>现在可以通过<code>https://[公网机ip]:端口</code>访问内网的Cloudreve了</p><p>打开公网机上的Cloudreve，点击<code>管理面板</code>→<code>离线下载节点</code>→<code>接入新节点</code>，打开添加新节点界面，复制生成的<code>从机密钥</code></p><p>在内网机上Cloudreve配置文件中添加：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Slave]</span></span><br><span class="line"><span class="attr">Secret</span> = 从机密钥</span><br></pre></td></tr></table></figure><p>并修改<code>Mode</code>字段的值为<code>slave</code>，重启Cloudreve</p><p>在管理面板从机地址中填入<code>https://[公网机ip]:端口</code>，并测试是否正常</p><p>点<code>下一步</code>→<code>启用</code>，在<code>RPC授权令牌</code>中填入<code>aria2c.conf</code>中的<code>rpc-secret</code></p><p><code>RPC服务地址</code>填<code>http://127.0.0.1:6800/</code></p><p>绝对路径填离线下载文件夹在内网机上的位置，如<code>/offline_download</code></p><p>完成后<code>测试aria2通信</code>，检查是否正常</p><p>点击下一步设置节点名字，自此，离线下载节点添加完成</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;在配置&lt;a href=&quot;https://rickg.cn/2022/05/29/cloudreve/&quot;&gt;Cloudreve&lt;/a&gt;期间，发现</summary>
      
    
    
    
    
    <category term="cloudreve" scheme="https://rickg.cn/tags/cloudreve/"/>
    
  </entry>
  
  <entry>
    <title>安装配置Cloudreve</title>
    <link href="https://rickg.cn/2022/05/29/cloudreve/"/>
    <id>https://rickg.cn/2022/05/29/cloudreve/</id>
    <published>2022-05-29T12:39:36.000Z</published>
    <updated>2022-06-03T13:52:13.646Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>自从申请到Office E5之后便有了容量高达5TB的OneDrive。心想怎能没有一个配套的网盘程序呢，于是便有了此文。</p><h3 id="何为Cloudreve？"><a href="#何为Cloudreve？" class="headerlink" title="何为Cloudreve？"></a>何为Cloudreve？</h3><p>以下内容来自<a href="https://docs.cloudreve.org/">官方文档</a></p><blockquote><p>Cloudreve 可以让您快速搭建起公私兼备的网盘系统。Cloudreve 在底层支持不同的云存储平台，用户在实际使用时无须关心物理存储方式。你可以使用 Cloudreve 搭建个人用网盘、文件分享系统，亦或是针对大小团体的公有云系统。</p></blockquote><h2 id="安装Cloudreve"><a href="#安装Cloudreve" class="headerlink" title="安装Cloudreve"></a>安装Cloudreve</h2><blockquote><p>本文以Debian 10 (buster)，amd64架构，Cloudreve 3.5.3为准，Cloudreve安装在&#x2F;opt&#x2F;cloudreve</p></blockquote><h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>前往<a href="https://github.com/cloudreve/Cloudreve/releases">Github Release</a>页面根据系统架构下载最新版本</p><h3 id="解压到-x2F-opt"><a href="#解压到-x2F-opt" class="headerlink" title="解压到&#x2F;opt"></a>解压到&#x2F;opt</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/cloudreve</span><br><span class="line">tar -zxvf cloudreve_3.5.3_linux_amd64.tar.gz -C /opt/cloudreve</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加可执行权限</span></span><br><span class="line">chmod +x /opt/cloudreve/cloudreve</span><br></pre></td></tr></table></figure><h3 id="获取初始管理员密码"><a href="#获取初始管理员密码" class="headerlink" title="获取初始管理员密码"></a>获取初始管理员密码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/cloudreve</span><br><span class="line">./cloudreve</span><br></pre></td></tr></table></figure><p>你应该看到如下图所示的界面</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220529184316860.png" alt="image-20220529184316860"></p><h3 id="配置systemd"><a href="#配置systemd" class="headerlink" title="配置systemd"></a>配置systemd</h3><p>新建<code>/usr/lib/systemd/system/cloudreve.service</code>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Cloudreve</span><br><span class="line">Documentation=https://docs.cloudreve.org</span><br><span class="line">After=network.target</span><br><span class="line">After=mysqld.service</span><br><span class="line">Wants=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">WorkingDirectory=/opt/cloudreve</span><br><span class="line">ExecStart=/opt/cloudreve/cloudreve</span><br><span class="line">Restart=on-abnormal</span><br><span class="line">RestartSec=5s</span><br><span class="line">KillMode=mixed</span><br><span class="line"></span><br><span class="line">StandardOutput=null</span><br><span class="line">StandardError=syslog</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>而后</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新配置</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">systemctl start cloudreve</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置开机启动</span></span><br><span class="line">systemctl enable cloudreve</span><br></pre></td></tr></table></figure><p>管理命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动服务</span></span><br><span class="line">systemctl start cloudreve</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">停止服务</span></span><br><span class="line">systemctl stop cloudreve</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">重启服务</span></span><br><span class="line">systemctl restart cloudreve</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看状态</span></span><br><span class="line">systemctl status cloudreve</span><br></pre></td></tr></table></figure><h3 id="配置反代"><a href="#配置反代" class="headerlink" title="配置反代"></a>配置反代</h3><p>现在可以通过<code>http://[server_ip]:5212</code>来访问Cloudreve了，若有通过HTTPS访问的需求，则需配置反代（以nginx为例）</p><p>在网站的<code>server</code>字段中加入：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> / &#123;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    <span class="attribute">proxy_set_header</span> Host <span class="variable">$http_host</span>;</span><br><span class="line">    <span class="attribute">proxy_redirect</span> <span class="literal">off</span>;</span><br><span class="line">    <span class="attribute">proxy_pass</span> http://127.0.0.1:5212;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果您要使用本地存储策略，请将下一行注释符删除，并更改大小为理论最大文件尺寸</span></span><br><span class="line">    <span class="comment"># client_max_body_size 20000m;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="配置Cloudreve"><a href="#配置Cloudreve" class="headerlink" title="配置Cloudreve"></a>配置Cloudreve</h2><p>访问Cloudreve后台，使用初始用户密码登录</p><p>点击右上角的头像→管理面板，会询问是否修正站点URL，确认即可</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220529184746382.png" alt="image-20220529184746382"></p><h3 id="修改默认用户密码"><a href="#修改默认用户密码" class="headerlink" title="修改默认用户密码"></a>修改默认用户密码</h3><p>在管理面板中点击<code>用户</code>，在右边的用户列表中修改即可</p><h3 id="添加存储策略"><a href="#添加存储策略" class="headerlink" title="添加存储策略"></a>添加存储策略</h3><p>管理面板→存储策略→添加存储策略，如下图所示</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220529185722835.png" alt="image-20220529185722835"></p><div class="tag-plugin link dis-select"><a class="link-card plain" title="各存储策略对比&nbsp;–&nbsp;Cloudreve" href="https://docs.cloudreve.org/use/policy/compare" target="_blank" rel="external nofollow noopener noreferrer"><div class="left"><span class="title">各存储策略对比&nbsp;–&nbsp;Cloudreve</span><span class="desc fs12">https://docs.cloudreve.org/use/policy/compare</span></div><div class="right"><div class="lazy img" data-bg="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/link/8f277b4ee0ecd.svg"></div></div></a></div><p>各存储策略的官方引导式配置已十分详细，这里不再赘述</p><h2 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h2><h3 id="忘记了密码？"><a href="#忘记了密码？" class="headerlink" title="忘记了密码？"></a>忘记了密码？</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/cloudreve/cloudreve --database-script ResetAdminPassword</span><br></pre></td></tr></table></figure><h3 id="校准用户容量"><a href="#校准用户容量" class="headerlink" title="校准用户容量"></a>校准用户容量</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/cloudreve/cloudreve --database-script CalibrateUserStorage</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;自从申请到Office E5之后便有了容量高达5TB的OneDrive。心想怎能没有一个配套的网盘程序呢，于是便有了此文。&lt;/p&gt;
&lt;h3 </summary>
      
    
    
    
    
    <category term="cloudreve" scheme="https://rickg.cn/tags/cloudreve/"/>
    
  </entry>
  
  <entry>
    <title>frp内网穿透教程</title>
    <link href="https://rickg.cn/2022/05/28/how-to-configure-frp/"/>
    <id>https://rickg.cn/2022/05/28/how-to-configure-frp/</id>
    <published>2022-05-28T07:33:35.000Z</published>
    <updated>2022-05-28T08:54:56.606Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="frp是什么"><a href="#frp是什么" class="headerlink" title="frp是什么"></a>frp是什么</h3><p>frp 是一个专注于内网穿透的高性能的反向代理应用，支持 TCP、UDP、HTTP、HTTPS 等多种协议。可以将内网服务以安全、便捷的方式通过具有公网 IP 节点的中转暴露到公网。</p><p>项目地址：<a href="https://github.com/fatedier/frp/">https://github.com/fatedier/frp/</a></p><h3 id="为什么要写这篇文章"><a href="#为什么要写这篇文章" class="headerlink" title="为什么要写这篇文章"></a>为什么要写这篇文章</h3><p>最近在折腾arma3的服务器，饱受没有公网ip之困扰。为此写下这篇教程记录我折腾内网穿透的整个过程。</p><blockquote><p>本文部分参考了<a href="https://gofrp.org/docs/">官方文档</a>的内容</p><p>全文以写作这篇文章的最新版（v0.43.0）为准</p><p>配置环境：Debian 10 64-bit</p></blockquote><h2 id="下载frp"><a href="#下载frp" class="headerlink" title="下载frp"></a>下载frp</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/fatedier/frp/releases/download/v0.43.0/frp_0.43.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure><h2 id="安装frp"><a href="#安装frp" class="headerlink" title="安装frp"></a>安装frp</h2><h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf frp_0.43.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure><h3 id="复制到系统目录"><a href="#复制到系统目录" class="headerlink" title="复制到系统目录"></a>复制到系统目录</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd frp_0.43.0_linux_amd64/</span><br><span class="line">mkdir -p /etc/frp</span><br><span class="line">mv *.ini /etc/frp</span><br><span class="line">mv frpc frps /usr/bin</span><br></pre></td></tr></table></figure><h3 id="配置systemd"><a href="#配置systemd" class="headerlink" title="配置systemd"></a>配置systemd</h3><h4 id="公网机"><a href="#公网机" class="headerlink" title="公网机"></a>公网机</h4><p>新建<code>/usr/lib/systemd/system/frps.service:</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Frp Server Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=nobody</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5s</span><br><span class="line">ExecStart=/usr/bin/frps -c /etc/frp/frps.ini</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>随后执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable frps</span><br></pre></td></tr></table></figure><h4 id="内网机"><a href="#内网机" class="headerlink" title="内网机"></a>内网机</h4><p>新建<code>/usr/lib/systemd/system/frpc.service:</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Frp Client Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">User=nobody</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=5s</span><br><span class="line">ExecStart=/usr/bin/frpc -c /etc/frp/frpc.ini</span><br><span class="line">ExecReload=/usr/bin/frpc reload -c /etc/frp/frpc.ini</span><br><span class="line">LimitNOFILE=1048576</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>随后执行</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable frpc</span><br></pre></td></tr></table></figure><h2 id="启动frp"><a href="#启动frp" class="headerlink" title="启动frp"></a>启动frp</h2><h3 id="公网机-1"><a href="#公网机-1" class="headerlink" title="公网机"></a>公网机</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start frps</span><br></pre></td></tr></table></figure><h3 id="内网机-1"><a href="#内网机-1" class="headerlink" title="内网机"></a>内网机</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start frpc</span><br></pre></td></tr></table></figure><blockquote><p>注：每次修改完配置应通过<code>systemctl restart</code>重启服务</p></blockquote><h2 id="配置frp"><a href="#配置frp" class="headerlink" title="配置frp"></a>配置frp</h2><h3 id="普通服务（以SSH为例）"><a href="#普通服务（以SSH为例）" class="headerlink" title="普通服务（以SSH为例）"></a>普通服务（以SSH为例）</h3><p>公网机修改<code>/etc/frp/frps.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br></pre></td></tr></table></figure><p>内网机修改<code>/etc/frp/frpc.ini</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = 公网机ip</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[ssh]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = 本地SSH端口</span><br><span class="line"><span class="attr">remote_port</span> = 公网访问服务用的端口</span><br></pre></td></tr></table></figure><p>其他服务以此类推，如我的Arma 3服务器配置为：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = xxx.xxx.xxx.xxx</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"></span><br><span class="line"><span class="section">[arma3-1]</span></span><br><span class="line"><span class="attr">type</span> = udp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">2302</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">2302</span></span><br><span class="line"></span><br><span class="line"><span class="section">[arma3-2]</span></span><br><span class="line"><span class="attr">type</span> = udp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">2303</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">2303</span></span><br></pre></td></tr></table></figure><h3 id="Web服务（HTTP）"><a href="#Web服务（HTTP）" class="headerlink" title="Web服务（HTTP）"></a>Web服务（HTTP）</h3><p>在公网机<code>frps.ini</code>中添加一行</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">8080</span></span><br></pre></td></tr></table></figure><p>即设置http请求端口为8080</p><p>在内网机<code>frpc.ini</code>中添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[web]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">custom_domains</span> = your.domain</span><br></pre></td></tr></table></figure><p>分别启动frps，frpc。并将your.domain的A记录解析至公网机</p><p>访问<code>http://your.domain:8080</code>来访问内网服务</p><h3 id="Web服务（HTTPS）"><a href="#Web服务（HTTPS）" class="headerlink" title="Web服务（HTTPS）"></a>Web服务（HTTPS）</h3><p>在公网机<code>/etc/frp/frps.ini</code>中添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">vhost_https_port</span> = <span class="number">443</span></span><br></pre></td></tr></table></figure><p>即设置https请求端口为443</p><h4 id="暴露本地HTTP服务"><a href="#暴露本地HTTP服务" class="headerlink" title="暴露本地HTTP服务"></a>暴露本地HTTP服务</h4><p>在内网机<code>/etc/frp/frpc.ini</code>中添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[test_htts2http]</span></span><br><span class="line"><span class="attr">type</span> = https</span><br><span class="line"><span class="attr">custom_domains</span> = your.domain</span><br><span class="line"></span><br><span class="line"><span class="attr">plugin</span> = https2http</span><br><span class="line"><span class="attr">plugin_local_addr</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPS 证书相关的配置</span></span><br><span class="line"><span class="attr">plugin_crt_path</span> = ./server.crt</span><br><span class="line"><span class="attr">plugin_key_path</span> = ./server.key</span><br><span class="line"><span class="attr">plugin_host_header_rewrite</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">plugin_header_X-From-Where</span> = frp</span><br></pre></td></tr></table></figure><p>分别启动frpc，frps</p><p>访问<code>https://your.domain</code>来访问内网服务</p><h4 id="暴露本地HTTPS服务"><a href="#暴露本地HTTPS服务" class="headerlink" title="暴露本地HTTPS服务"></a>暴露本地HTTPS服务</h4><p>在内网机<code>/etc/frp/frpc.ini</code>中添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[https2https]</span></span><br><span class="line"><span class="attr">type</span> = https</span><br><span class="line"><span class="attr">custom_domains</span> = your.domain</span><br><span class="line"></span><br><span class="line"><span class="attr">plugin</span> = https2https</span><br><span class="line"><span class="attr">plugin_local_addr</span> = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">443</span></span><br><span class="line"><span class="comment"># 证书和密钥位置</span></span><br><span class="line"><span class="attr">plugin_crt_path</span> = /etc/frp/server.crt</span><br><span class="line"><span class="attr">plugin_key_path</span> = /etc/frp/server.key</span><br></pre></td></tr></table></figure><h2 id="杂项"><a href="#杂项" class="headerlink" title="杂项"></a>杂项</h2><h3 id="服务端Web界面"><a href="#服务端Web界面" class="headerlink" title="服务端Web界面"></a>服务端Web界面</h3><p>在公网机的<code>/etc/frp/frps.ini</code>的<code>common</code>中添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dashboard_port</span> = <span class="number">7500</span></span><br><span class="line"><span class="comment"># 用户名和密码</span></span><br><span class="line"><span class="attr">dashboard_user</span> = admin</span><br><span class="line"><span class="attr">dashboard_pwd</span> = admin</span><br></pre></td></tr></table></figure><p>通过<code>http://[公网机ip]:7500</code>来访问服务端Web界面</p><h3 id="客户端Web界面"><a href="#客户端Web界面" class="headerlink" title="客户端Web界面"></a>客户端Web界面</h3><p>在内网机的<code>/etc/frp/frpc.ini</code>的<code>common</code>中添加</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">admin_addr</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">admin_port</span> = <span class="number">7400</span></span><br><span class="line"><span class="attr">admin_user</span> = admin</span><br><span class="line"><span class="attr">admin_pwd</span> = admin</span><br></pre></td></tr></table></figure><p>通过<code>http://127.0.0.1:7400</code>来访问客户端Web界面</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;h3 id=&quot;frp是什么&quot;&gt;&lt;a href=&quot;#frp是什么&quot; class=&quot;headerlink&quot; title=&quot;frp是什么&quot;&gt;&lt;/a&gt;f</summary>
      
    
    
    
    
    <category term="frp" scheme="https://rickg.cn/tags/frp/"/>
    
    <category term="教程" scheme="https://rickg.cn/tags/%E6%95%99%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>在自有服务器上部署Snapdrop</title>
    <link href="https://rickg.cn/2022/05/28/deploy-snapdrop/"/>
    <id>https://rickg.cn/2022/05/28/deploy-snapdrop/</id>
    <published>2022-05-28T07:26:54.000Z</published>
    <updated>2022-06-03T13:52:20.326Z</updated>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>购入笔记本和备用机后，对于家里多设备互传文件需求增加了，恰好被<a href="https://copur.xyz/">@Copur</a>安利这样一个项目，于是便打算在自己的服务器上部署</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="Bellisario/node-snapdrop:&nbsp;Node&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;Snapdrop" href="https://github.com/Bellisario/node-snapdrop" target="_blank" rel="external nofollow noopener noreferrer"><div class="left"><span class="title">Bellisario/node-snapdrop:&nbsp;Node&nbsp;version&nbsp;of&nbsp;the&nbsp;original&nbsp;Snapdrop</span><span class="desc fs12">https://github.com/Bellisario/node-snapdrop</span></div><div class="right"><div class="lazy img" data-bg="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/link/8f277b4ee0ecd.svg"></div></div></a></div><h2 id="服务器端配置"><a href="#服务器端配置" class="headerlink" title="服务器端配置"></a>服务器端配置</h2><p>clone项目</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Bellisario/node-snapdrop.git</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">速度慢可考虑fastgit</span></span><br><span class="line">git clone https://hub.fastgit.xyz/Bellisario/node-snapdrop.git</span><br></pre></td></tr></table></figure><p>安装依赖</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd node-snapdrop</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>安装pm2</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g pm2</span><br></pre></td></tr></table></figure><p>启动Snapdrop</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start index.js</span><br></pre></td></tr></table></figure><p>现在可以通过localhost:3000来访问Snapdrop了</p><h2 id="反代配置"><a href="#反代配置" class="headerlink" title="反代配置"></a>反代配置</h2><p>在网站nginx配置文件头部加入</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">map</span> <span class="variable">$http_upgrade</span> <span class="variable">$connection_upgrade</span> &#123;</span><br><span class="line"><span class="attribute">default</span> upgrade;</span><br><span class="line">&#x27;&#x27; close;</span><br><span class="line">&#125;</span><br><span class="line"><span class="section">upstream</span> websocket &#123;</span><br><span class="line">  <span class="attribute">server</span> <span class="number">127.0.0.1:3000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在反代配置文件的<code>location ^~ /</code> 下加入</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">proxy_set_header</span> Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line"><span class="attribute">proxy_set_header</span> Connection <span class="variable">$connection_upgrade</span>;</span><br></pre></td></tr></table></figure><h2 id="CDN配置-（以又拍云为例）"><a href="#CDN配置-（以又拍云为例）" class="headerlink" title="CDN配置 （以又拍云为例）"></a>CDN配置 （以又拍云为例）</h2><p>又拍云控制台创建WebSocket服务，域名填需要绑定的域名，协议http，端口80，如图所示</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220528152422766.png" alt="image-20220528152422766"></p><p>随后在服务的https配置中添加证书，配置完成</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h2&gt;&lt;p&gt;购入笔记本和备用机后，对于家里多设备互传文件需求增加了，恰好被&lt;a href=&quot;https://copur.xyz/&quot;&gt;@Copur&lt;/a&gt;</summary>
      
    
    
    
    
    <category term="Snapdrop" scheme="https://rickg.cn/tags/Snapdrop/"/>
    
  </entry>
  
  <entry>
    <title>powershell美化</title>
    <link href="https://rickg.cn/2022/05/28/powershell-polish/"/>
    <id>https://rickg.cn/2022/05/28/powershell-polish/</id>
    <published>2022-05-28T05:20:40.000Z</published>
    <updated>2022-06-03T13:52:29.287Z</updated>
    
    <content type="html"><![CDATA[<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220528135813783.png" alt="image-20220528135813783"></p><h2 id="安装oh-my-posh"><a href="#安装oh-my-posh" class="headerlink" title="安装oh-my-posh"></a>安装oh-my-posh</h2><p>在Microsoft Store安装Windows Terminal</p><p>执行如下命令</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Bypass</span><br><span class="line"><span class="built_in">Install-Module</span> <span class="built_in">oh</span><span class="literal">-my-posh</span> <span class="literal">-Scope</span> CurrentUser</span><br><span class="line"><span class="built_in">Install-Module</span> posh<span class="literal">-git</span> <span class="literal">-Scope</span> CurrentUser</span><br></pre></td></tr></table></figure><p>如有提示按y即可</p><h2 id="启用oh-my-posh"><a href="#启用oh-my-posh" class="headerlink" title="启用oh-my-posh"></a>启用oh-my-posh</h2><p>配置PowerShell启动脚本</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">notepad <span class="variable">$PROFILE</span></span><br></pre></td></tr></table></figure><p>导入相应模块</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Import-Module</span> <span class="built_in">oh</span><span class="literal">-my-posh</span></span><br><span class="line"><span class="built_in">Import-Module</span> posh<span class="literal">-git</span></span><br></pre></td></tr></table></figure><p>设置主题为agnosterplus</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-PoshPrompt</span> <span class="literal">-Theme</span> agnosterplus</span><br></pre></td></tr></table></figure><h2 id="解决字体乱码"><a href="#解决字体乱码" class="headerlink" title="解决字体乱码"></a>解决字体乱码</h2><blockquote><p>参见 <a href="https://ohmyposh.dev/docs/fonts">Oh My Posh Docs</a></p></blockquote><p>下载Nerd Fonts，这里我选择的是Meslo Fonts</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="下载地址" href="https://www.nerdfonts.com/font-downloads" target="_blank" rel="external nofollow noopener noreferrer"><div class="left"><span class="title">下载地址</span><span class="desc fs12">https://www.nerdfonts.com/font-downloads</span></div><div class="right"><div class="lazy img" data-bg="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/link/8f277b4ee0ecd.svg"></div></div></a></div><p>解压，选择<code>Meslo LG S Regular Nerd Font Complete Windows Compatible.ttf</code>并安装</p><p>打开Windows Terminal，按<code>Ctrl + ,</code> 打开设置，点击<code>Windows Powershell</code> –&gt; <code>外观</code>，将字体改为刚才安装的<code>MesloLGS NF</code>，如图所示</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220528135059127.png" alt="image-20220528135059127"></p><h2 id="启用模糊背景"><a href="#启用模糊背景" class="headerlink" title="启用模糊背景"></a>启用模糊背景</h2><p><code>设置</code> –&gt; <code>Windows Powershell</code> –&gt; <code>外观</code> –&gt; <code>透明度</code></p><p>启用 <code>Enable acrylic</code> 项</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220528135302118.png" alt="image-20220528135302118"></p><h2 id="允许PowerShell执行任意脚本"><a href="#允许PowerShell执行任意脚本" class="headerlink" title="允许PowerShell执行任意脚本"></a>允许PowerShell执行任意脚本</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set-ExecutionPolicy</span> Unrestricted</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;效果图&quot;&gt;&lt;a href=&quot;#效果图&quot; class=&quot;headerlink&quot; title=&quot;效果图&quot;&gt;&lt;/a&gt;效果图&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/im</summary>
      
    
    
    
    
    <category term="powershell" scheme="https://rickg.cn/tags/powershell/"/>
    
    <category term="美化" scheme="https://rickg.cn/tags/%E7%BE%8E%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>基于pve的Openwrt安装及配置</title>
    <link href="https://rickg.cn/2022/05/25/pve-openwrt/"/>
    <id>https://rickg.cn/2022/05/25/pve-openwrt/</id>
    <published>2022-05-25T07:10:34.000Z</published>
    <updated>2022-06-03T13:50:35.552Z</updated>
    
    <content type="html"><![CDATA[<h2 id="机器介绍"><a href="#机器介绍" class="headerlink" title="机器介绍"></a>机器介绍</h2><table><thead><tr><th align="center">类别</th><th align="center">型号</th></tr></thead><tbody><tr><td align="center">CPU</td><td align="center">Xeon X3440 @ 2.53GHz</td></tr><tr><td align="center">主板</td><td align="center">Supermicro X8SIL</td></tr><tr><td align="center">内存</td><td align="center">Kingston ECC 8GB DDR3-1600</td></tr><tr><td align="center">硬盘</td><td align="center">Kingston UV400</td></tr><tr><td align="center">系统</td><td align="center">Proxmox VE 7.2</td></tr></tbody></table><h2 id="Proxmox-VE的安装与配置"><a href="#Proxmox-VE的安装与配置" class="headerlink" title="Proxmox VE的安装与配置"></a>Proxmox VE的安装与配置</h2><h3 id="Step-1-制作启动盘"><a href="#Step-1-制作启动盘" class="headerlink" title="Step.1 制作启动盘"></a>Step.1 制作启动盘</h3><p>在<a href="https://www.proxmox.com/en/downloads/category/iso-images-pve">pve官网</a>下载pve的镜像（我这里使用的是7.2版，下载速度可能很慢，方法…你们懂得）然后使用相关工具写入即可，推荐使用<a href="https://etcher.io/">balenaEtcher</a>。</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/image-20220525141530555.png" alt="写入启动盘"></p><h3 id="Step-2-安装pve"><a href="#Step-2-安装pve" class="headerlink" title="Step.2 安装pve"></a>Step.2 安装pve</h3><p>将U盘插入电脑，开机选择U盘启动，进入引导界面，选择<code>Install Proxmox VE</code>进入pve安装程序</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-boot.png" alt="pve引导界面"></p><p>点agree同意协议</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-license.png" alt="pve-license"></p><p>选择安装磁盘（这里开了个虚拟机来截图）</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-seldisk.png" alt="pve-seldisk"></p><p>设置root密码和邮箱</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-password.png" alt="pve-password"></p><p>按实际情况配置网络，一般情况下会自动获取ip等信息</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-setnetwork.png" alt="pve-setnetwork"></p><p>最后确认信息，点<code>Install</code>安装系统</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-confirm.png" alt="pve-confirm"></p><h3 id="Step-3-配置pve"><a href="#Step-3-配置pve" class="headerlink" title="Step.3 配置pve"></a>Step.3 配置pve</h3><p>安装完后通过<code>https://[你设置的ip，如图中的192.168.3.7]:8006</code>访问pve管理界面</p><p>username填root，密码填安装系统时设置的密码</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-login.png" alt="pve-login"></p><p>进入管理界面会弹出无有效订阅的提示，这个我们稍后会消除</p><p>选择左边数据中心下的唯一一个节点，点击<code>Shell</code>进入终端，运行以下命令安装pvetools：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;nameserver  8.8.8.8&quot; &gt;&gt; /etc/resolv.conf &amp;&amp; rm /etc/apt/sources.list.d/pve-enterprise.list &amp;&amp; export LC_ALL=en_US.UTF-8 &amp;&amp; apt update &amp;&amp; apt -y install git &amp;&amp; git clone https://github.com/ivanhao/pvetools.git &amp;&amp; cd pvetools &amp;&amp; ./pvetools.sh</span><br></pre></td></tr></table></figure><p>安装完成后会自动打开pvetools，语言选择中文</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-pvetools.png" alt="pve-pvetools"></p><p>配置国内源并去除订阅提示，其他按需求选择（我的Openwrt需要一个直通网口，这里配置了直通）</p><p>完成后执行<code>reboot</code>重启，这时再打开管理界面，烦人的订阅提示已经消失了</p><h2 id="OpenWrt的安装与配置"><a href="#OpenWrt的安装与配置" class="headerlink" title="OpenWrt的安装与配置"></a>OpenWrt的安装与配置</h2><h3 id="Step-1-配置虚拟机"><a href="#Step-1-配置虚拟机" class="headerlink" title="Step.1 配置虚拟机"></a>Step.1 配置虚拟机</h3><p>点击管理界面右上角的<code>创建虚拟机</code>，名称随便</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-createvm.png" alt="pve-createvm"></p><p>选择<code>不使用任何介质</code></p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-selsystem.png" alt="pve-selsystem"></p><p>机型，BIOS什么的保持默认。磁盘大小默认，待会要删除</p><p>CPU这里我选择1核</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-cpu.png" alt="pve-cpu"></p><p>内存按需求定，这里我填1024MB</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-memory.png" alt="pve-memory"></p><p>网络这里，模型选virtio（性能较高，除了OpenWrt里会提示半双工，实际上是全双工）。这里使用OpenWrt的防火墙，将防火墙一项取消选择</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-network2.png" alt="pve-network2"></p><p>最后创建虚拟机，完成后在左边列表里选择虚拟机，点击右边的<code>硬件</code>，选中刚创建的虚拟磁盘，点击<code>分离</code>，选中分离出的硬盘，点击<code>删除</code></p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-deldisk.png" alt="pve-deldisk"></p><h3 id="Step-2-安装OpenWrt"><a href="#Step-2-安装OpenWrt" class="headerlink" title="Step.2 安装OpenWrt"></a>Step.2 安装OpenWrt</h3><p>选取适合自己的OpenWrt镜像，这里推荐一个</p><div class="tag-plugin link dis-select"><a class="link-card plain" title="FW867&nbsp;大神&nbsp;KoolShare&nbsp;LEDE&nbsp;软路由固件" href="https://www.koolcenter.com/posts/49" target="_blank" rel="external nofollow noopener noreferrer"><div class="left"><span class="title">FW867&nbsp;大神&nbsp;KoolShare&nbsp;LEDE&nbsp;软路由固件</span><span class="desc fs12">https://www.koolcenter.com/posts/49</span></div><div class="right"><div class="lazy img" data-bg="https://fastly.jsdelivr.net/gh/cdn-x/placeholder@1.0.1/link/8f277b4ee0ecd.svg"></div></div></a></div><p>将镜像（img格式）上传到pve中</p><blockquote><p>注：这里我合并了local和local-lvm，因此图中只显示local</p></blockquote><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-uploadiso.png" alt="pve-uploadiso"></p><p>在pve的shell中输入：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qm importdisk 虚拟机id /var/lib/vz/template/iso/镜像名字.img local-lvm</span><br></pre></td></tr></table></figure><p>导入成功后显示successful</p><p>回到虚拟机<code>硬件</code>界面，选中新添加的硬盘，点击<code>编辑</code>，选择设备类型为<code>SATA</code>，点击<code>添加</code>，完成</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-add-disk.png" alt="pve-add-disk"></p><p>进入虚拟机<code>选项</code>页面，点击<code>引导顺序</code>，只选择新添加的SATA硬盘，点击<code>OK</code>保存</p><p><img src="https://fastly.jsdelivr.net/gh/rickgcn/cdn-assets/img/pve-boot-order.png" alt="pve-boot-order"></p><p>启动虚拟机，进入openwrt</p><blockquote><p>若启动虚拟机时报错：failed to set iommu for container</p><p>请执行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;options vfio_iommu_type1 allow_unsafe_interrupts=1&quot; &gt; /etc/modprobe.d/iommu_unsafe_interrupts.conf</span><br></pre></td></tr></table></figure><p>而后重启即可解决问题</p></blockquote><p>未完待续…</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;机器介绍&quot;&gt;&lt;a href=&quot;#机器介绍&quot; class=&quot;headerlink&quot; title=&quot;机器介绍&quot;&gt;&lt;/a&gt;机器介绍&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;类别&lt;/th&gt;
&lt;th align=&quot;center</summary>
      
    
    
    
    
    <category term="openwrt" scheme="https://rickg.cn/tags/openwrt/"/>
    
    <category term="pve" scheme="https://rickg.cn/tags/pve/"/>
    
    <category term="软路由" scheme="https://rickg.cn/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/"/>
    
  </entry>
  
</feed>
